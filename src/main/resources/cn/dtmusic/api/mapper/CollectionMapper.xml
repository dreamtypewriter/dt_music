<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dtmusic.api.mapper.CollectionMapper">
    <resultMap id="BaseResultMap" type="cn.dtmusic.api.dto.SongDto">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        <id column="song_id" jdbcType="INTEGER" property="songId"/>
        <result column="song_img_path" jdbcType="VARCHAR" property="songImgPath"/>
        <result column="song_path" jdbcType="VARCHAR" property="songPath"/>
        <result column="song_name" jdbcType="VARCHAR" property="songName"/>
        <result column="song_length" jdbcType="VARCHAR" property="songLength"/>
        <result column="song_description" jdbcType="VARCHAR" property="songDescription"/>
        <result column="song_lyrics" jdbcType="VARCHAR" property="songLyrics"/>
        <result column="comment_count" jdbcType="INTEGER" property="commentCount"/>
        <result column="play_count" jdbcType="INTEGER" property="playCount"/>
        <result column="collection_count" jdbcType="INTEGER" property="collectionCount"/>
        <result column="download_count" jdbcType="INTEGER" property="downloadCount"/>
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="modify_date" jdbcType="TIMESTAMP" property="modifyDate"/>
        <result column="song_status" jdbcType="INTEGER" property="songStatus"/>

        <association property="albumDto" javaType="cn.dtmusic.api.dto.AlbumDto" autoMapping="true">
            <id column="album_id" property="albumId"></id>
            <result column="album_name" jdbcType="VARCHAR" property="albumName"/>
            <result column="album_img_path" jdbcType="VARCHAR" property="albumImgPath"/>
            <result column="album_language" jdbcType="VARCHAR" property="albumLanguage"/>
            <result column="collection_count" jdbcType="INTEGER" property="collectionCount"/>
            <result column="release_date" jdbcType="DATE" property="releaseDate"/>
            <result column="release_company" jdbcType="VARCHAR" property="releaseCompany"/>
            <result column="album_description" jdbcType="VARCHAR" property="albumDescription"/>
            <result column="comment_count" jdbcType="INTEGER" property="commentCount"/>
            <result column="create_date" jdbcType="TIMESTAMP" property="createDate"/>
            <result column="modify_date" jdbcType="TIMESTAMP" property="modifyDate"/>
            <result column="album_status" jdbcType="TINYINT" property="albumStatus"/>
        </association>

        <association property="singer" javaType="cn.dtmusic.api.entity.Singer" autoMapping="true">
            <id column="singer_id" property="singerId"></id>
            <result column="singer_name" jdbcType="VARCHAR" property="singerName"/>
            <result column="singer_img" jdbcType="VARCHAR" property="singerImg"/>
            <result column="singer_type" jdbcType="VARCHAR" property="singerType"/>
            <result column="singer_language" jdbcType="VARCHAR" property="singerLanguage"/>
            <result column="singer_description" jdbcType="VARCHAR" property="singerDescription"/>
            <result column="collection_count" jdbcType="INTEGER" property="collectionCount"/>
            <result column="singer_status" jdbcType="TINYINT" property="singerStatus"/>
        </association>
    </resultMap>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        delete from t_song
        where song_id = #{songId,jdbcType=INTEGER}
    </delete>

    <insert id="insert" parameterType="cn.dtmusic.api.dto.SongDto">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        insert into t_song (song_id, song_name, song_path,song_img_path,song_length,singer_id,
        album_id,song_description, song_lyrics)
        values (#{songId,jdbcType=INTEGER}, #{songName,jdbcType=VARCHAR},#{songPath,jdbcType=VARCHAR},#{songImgPath,jdbcType=VARCHAR},
        #{songLength,jdbcType=VARCHAR},#{singer.singerId,jdbcType=INTEGER},
        #{albumDto.albumId,jdbcType=INTEGER},
        #{songDescription,jdbcType=VARCHAR}, #{songLyrics,jdbcType=VARCHAR})
    </insert>
    <update id="updateByPrimaryKey" parameterType="cn.dtmusic.api.dto.SongDto">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        update t_song
        set song_name = #{songName,jdbcType=VARCHAR},
        song_length = #{songLength,jdbcType=VARCHAR},
        song_img_path = #{songImgPath,jdbcType=VARCHAR},
        singer_id = #{singer.singerId,jdbcType=INTEGER},
        album_id = #{albumDto.albumId,jdbcType=INTEGER},
        song_description = #{songDescription,jdbcType=VARCHAR},
        song_lyrics = #{songLyrics,jdbcType=VARCHAR}
        where song_id = #{songId,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        SELECT* FROM t_song a LEFT JOIN t_album b ON a.`album_id` = b.`album_id`
        LEFT JOIN t_singer c ON a.`singer_id` = c.`singer_id`
        AND a.`song_status` = 1
        AND c.`singer_status` = 1
        AND b.`album_status` = 1
        where a.`song_id` = #{value}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        SELECT* FROM t_song a LEFT JOIN t_album b ON a.`album_id` = b.`album_id`
        LEFT JOIN t_singer c ON a.`singer_id` = c.`singer_id`
        AND c.`singer_status` = 1
        AND b.`album_status` = 1
        WHERE a.`song_status` = 1
    </select>

    <select id="selectSongsByPage" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Sep 27 19:32:50 CST 2020.
        -->
        SELECT* FROM t_song a LEFT JOIN t_album b ON a.`album_id` = b.`album_id`
        LEFT JOIN t_singer c ON a.`singer_id` = c.`singer_id`
        AND c.`singer_status` = 1
        AND b.`album_status` = 1
        WHERE a.`song_status` = 1
        <if test="songName != null">
            and a.song_name like '%${songName}%'
        </if>
        <if test="singerName != null">
            and c.singer_name like '%${singerName}%'
        </if>

    </select>

    <select id="selectSongsBySongList" resultMap="BaseResultMap">
        SELECT* FROM t_song a LEFT JOIN t_album b ON a.`album_id` = b.`album_id`
        LEFT JOIN t_singer c ON a.`singer_id` = c.`singer_id`
        LEFT JOIN t_list_song ls ON a.song_id=ls.`song_id`
        WHERE ls.`song_list_id`=#{songListId}
    </select>

    <select id="selectTopCollectedSongsBySinger" resultMap="BaseResultMap">
        SELECT * FROM t_song WHERE singer_id=#{songListId} ORDER BY collection_count DESC LIMIT 0,20
    </select>

    <select id="selectSongsByAlbum" resultMap="BaseResultMap">
        SELECT * FROM t_song ts WHERE ts.album_id = #{albumId} AND ts.song_id NOT IN
        (SELECT song_id FROM t_list_song WHERE song_list_id = #{songListId})
    </select>

    <update id="updateSongStatus" parameterType="java.lang.Integer">
        update t_song set song_status = 0 where song_id = #{value}
    </update>

</mapper>
