<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dtmusic.api.mapper.AlbumMapper">
  <resultMap id="BaseResultMap" type="cn.dtmusic.api.dto.AlbumDto">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    <id column="album_id" jdbcType="INTEGER" property="albumId" />
    <result column="album_name" jdbcType="VARCHAR" property="albumName" />
    <result column="album_img_path" jdbcType="VARCHAR" property="albumImgPath" />
    <result column="album_language" jdbcType="VARCHAR" property="albumLanguage" />
    <result column="collection_count" jdbcType="INTEGER" property="collectionCount" />
    <result column="release_date" jdbcType="DATE" property="releaseDate" />
    <result column="release_company" jdbcType="VARCHAR" property="releaseCompany" />
    <result column="album_description" jdbcType="VARCHAR" property="albumDescription" />
    <result column="comment_count" jdbcType="INTEGER" property="commentCount" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="modify_date" jdbcType="TIMESTAMP" property="modifyDate" />
    <result column="album_status" jdbcType="TINYINT" property="albumStatus"/>

    <association property="singer" javaType="cn.dtmusic.api.entity.Singer">
      <id column="singer_id" jdbcType="INTEGER" property="singerId"/>
      <result column="singer_name" jdbcType="VARCHAR" property="singerName"/>
      <result column="singer_img" jdbcType="VARCHAR" property="singerImg"/>
      <result column="singer_type" jdbcType="VARCHAR" property="singerType"/>
      <result column="singer_language" jdbcType="VARCHAR" property="singerLanguage"/>
      <result column="singer_description" jdbcType="VARCHAR" property="singerDescription"/>
      <result column="collection_count" jdbcType="INTEGER" property="collectionCount"/>
      <result column="singer_status" jdbcType="TINYINT" property="singerStatus"/>
    </association>

    <collection property="songs" ofType="cn.dtmusic.api.dto.SongDto" >
    <id column="song_id" jdbcType="INTEGER" property="songId" />
    <result column="song_name" jdbcType="VARCHAR" property="songName" />
    <result column="song_length" jdbcType="VARCHAR" property="songLength" />
    <association property="singer" javaType="cn.dtmusic.api.entity.Singer">
      <id property="singerId" column="singer_id"></id>
      <result column="singer_name" jdbcType="VARCHAR" property="singerName"/>
    </association>
    <association property="albumDto" javaType="cn.dtmusic.api.dto.AlbumDto">
      <id column="album_id" jdbcType="INTEGER" property="albumId" />
      <result column="album_name" jdbcType="VARCHAR" property="albumName" />
    </association>
    </collection>

  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    delete from t_album
    where album_id = #{albumId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="cn.dtmusic.api.dto.AlbumDto">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    insert into t_album (album_id, album_name, album_img_path, album_language,
      release_date, release_company, album_description,singer_id
      )
    values (#{albumId,jdbcType=INTEGER}, #{albumName,jdbcType=VARCHAR}, #{albumImgPath,jdbcType=VARCHAR}, #{albumLanguage,jdbcType=VARCHAR},
      #{releaseDate,jdbcType=DATE}, #{releaseCompany,jdbcType=VARCHAR}, #{albumDescription,jdbcType=VARCHAR},#{singer.singerId,jdbcType=INTEGER}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.dtmusic.api.dto.AlbumDto">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    update t_album
    set album_name = #{albumName,jdbcType=VARCHAR},
      album_img_path = #{albumImgPath,jdbcType=VARCHAR},
      singer_id = #{singer.singerId,jdbcType=INTEGER},
      album_language = #{albumLanguage,jdbcType=VARCHAR},
      collection_count = #{collectionCount,jdbcType=INTEGER},
      release_date = #{releaseDate,jdbcType=DATE},
      release_company = #{releaseCompany,jdbcType=VARCHAR},
      album_description = #{albumDescription,jdbcType=VARCHAR},
      comment_count = #{commentCount,jdbcType=INTEGER}
    where album_id = #{albumId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    select * from t_album a inner join t_singer b on a.singer_id = b.singer_id
    where album_id = #{albumId,jdbcType=INTEGER} and album_status = 1
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    select * from t_album a inner join t_singer b on a.singer_id = b.singer_id where album_status = 1
  </select>

  <select id="selectAlbumByName" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 10:09:48 CST 2020.
    -->
    select * from t_album a inner join t_singer b on a.singer_id = b.singer_id
     where album_name like '%${albumName}%' and  album_status = 1
  </select>

  <select id="selectAlbumBySinger" resultMap="BaseResultMap">
    SELECT * FROM t_album WHERE singer_id=#{singerId} and album_status=1
  </select>

  <select id="selectTopAlbum" resultMap="BaseResultMap">
    select * from t_album a inner join t_singer b on a.singer_id = b.singer_id where album_status = 1 ORDER BY a.collection_count DESC LIMIT 6
  </select>

  <update id="updateAlbumStatus" parameterType="java.lang.Integer">
    update t_album set album_status = 0 where album_id = #{value}
  </update>
</mapper>
